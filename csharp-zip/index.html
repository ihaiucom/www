<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <meta name="author" content="ihaiu" />
    <title>C#实现Zip压缩解压实例</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/github-light.css" media="screen">
    <link type="text/css" rel="stylesheet" href="/stylesheets/offlintab-439.css">
    <link type="stylesheet" rel="stylesheet" href="/stylesheets/font-awesome.min.css">
    <!-- <link type="stylesheet" rel="stylesheet" href="/stylesheets/about-grid.css"> -->


    <!-- <link href="/feed/" rel="alternate" title="ihaiu" type="application/atom+xml" /> -->

    <link rel="shortcut icon" href="/assets/icon/favicon.ico" />

    <link href="/assets/icon/favicon.ico" type="image/x-icon" rel="shortcut icon bookmark" />
    <link rel="apple-touch-icon-precomposed" href="assets/icon/icon32.png">
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/icon/icon76.png">
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/icon/icon120.png">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/icon/icon152.png">

  <!-- 
  <script src="http://www.it165.net/statics/js//it165_pro.js" type="text/javascript"></script>
  <script type="text/javascript">SyntaxHighlighter.all();</script>
  -->


           
    <script type="text/javascript" src="/media/syntaxhighlighter_2.0.278/scripts/shCore.js"></script>
    <link type="text/css" rel="stylesheet" href="/media/syntaxhighlighter_2.0.278/styles/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="/media/syntaxhighlighter_2.0.278/styles/shThemeDefault.css"/>


      

      

      

      

      

      
      <script type="text/javascript" src="/media/syntaxhighlighter_2.0.278/scripts/shBrushCSharp.js"></script>
      

      

      

      

      

      

      


      

      
      

      

      

      

      

      

      

      

      

      

      

      



    <script type="text/javascript">SyntaxHighlighter.all();</script>


   

  </head>

  <body>
    <section class="page-header">
      <a href="http://www.ihaiu.com" class="iconbtn"><h1 style="background-image: url('/assets/icon/icon76_white.png'); background-position: center center; background-repeat:no-repeat; height:76px; margin:0px;"></h1></a>
      <a href="http://www.ihaiu.com" class="iconbtn"><h1 class="project-name" >爱海游</h1></a>
      <h2 class="project-tagline">ihaiu.com</h2>
      <a href="/#content" class="btn">目录</a>
      <a href="/categories/#content" class="btn">分类</a>
     <!--  <a href="/guestbook/#content" class="btn">留言</a> -->
     <!--  <a href="/about/#content" class="btn">关于</a> -->
      <a href="/opensource/#content" class="btn">开源分享</a>
      <a href="/share/#content" class="btn">分享</a>
     <!--  <a href="/share/gameart#content" class="btn">游戏美术</a> -->
      <a href="/friendlylink/#content" class="btn">友情链接</a>
    </section>





    <section class="main-content" id="content">

      <h1>C#实现Zip压缩解压实例</h1>
      <article class="content">
        <section class="meta">
<span class="time">
  <time datetime="2017-01-05">2017-01-05</time>
</span>

 | 
<span class="categories">
  发布
  <a href="tencent://message/?uin=593705098" title="发布:大海明月 QQ:593705098" rel="author">大海明月</a>&nbsp;
  
  <a href="mailto:zengfeng75@qq.com" title="发布:大海明月 Email:zengfeng75@qq.com" rel="author">zengfeng75@qq.com</a>&nbsp;
  
</span>



 | 
<span class="categories">
  分类
  
  <a href="/categories/#C#" title="C#">C#</a>&nbsp;
  
</span>


 | 
<span class="tags">
  标签
  
  <a href="/tags/#C#" title="C#">C#</a>&nbsp;
  
  <a href="/tags/#Zip" title="Zip">Zip</a>&nbsp;
  
</span>

</section>
<section class="post">
<p><br />
<br /></p>
<h2 class="nav1">相关文档 </h2>
<p><a href="http://blog.csdn.net/cleopard/article/details/42156393" target="_blank">参考文档《C#实现Zip压缩解压实例》他这个有几个Bug</a></p>
<p><a href="https://github.com/icsharpcode/SharpZipLib/tree/master/Documentation" target="_blank">[官网下载]SharpZipLib.chm</a></p>
<p><a href="http://icsharpcode.github.io/SharpZipLib/" target="_blank">[官网下载]SharpZipLib</a></p>
<p><a href="https://sourceforge.net/projects/sharpdevelop/files/SharpZipLib/0.86/SharpZipLib_0860_Bin.zip/download" target="_blank">[官网下载] SharpZipLib Dll</a></p>
<p><a href="/assets/down/SharpZipLib_0860_Bin.zip" target="_blank">[本地下载]SharpZipLib Dll </a></p>

<p><br />
<br /></p>
<h2 class="nav2">中文路径名乱码问题</h2>
<pre class="brush: csharp; ">

    private static void SetCode()
    {
        // 需要注意的是 默认编码如果有中文的文件名或目录将会乱码，甚至解压的数据出错。所以设置一下支持中文的编码
        ZipConstants.DefaultCodePage = Encoding.UTF8.CodePage;
    }

</pre>
<p><br />
<br /></p>

<h2 class="nav1">ZipHelper.cs</h2>
<pre class="brush: csharp; ">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;
using ICSharpCode.SharpZipLib;
using ICSharpCode.SharpZipLib.Zip;
using ICSharpCode.SharpZipLib.Checksums;

/// &lt;summary&gt; 
/// 适用与ZIP压缩 
/// &lt;/summary&gt; 
public class ZipHelper
{

    private static void SetCode()
    {
        // 需要注意的是 默认编码如果有中文的文件名或目录将会乱码，甚至解压的数据出错。所以设置一下支持中文的编码
        ZipConstants.DefaultCodePage = Encoding.UTF8.CodePage;
    }


    private static List&lt;string&gt; ignoreExts = new List&lt;string&gt;(new string[]{ &quot;.meta&quot;, &quot;.manifest&quot;});
    private static List&lt;string&gt; ignoreFiles = new List&lt;string&gt;(new string[]{ &quot;.ds_store&quot;});

    #region 压缩

    /// &lt;summary&gt; 
    /// 递归压缩文件夹的内部方法 
    /// &lt;/summary&gt; 
    /// &lt;param name=&quot;folderToZip&quot;&gt;要压缩的文件夹路径&lt;/param&gt; 
    /// &lt;param name=&quot;zipStream&quot;&gt;压缩输出流&lt;/param&gt; 
    /// &lt;param name=&quot;parentFolderName&quot;&gt;此文件夹的上级文件夹&lt;/param&gt; 
    /// &lt;returns&gt;&lt;/returns&gt; 
    private static bool ZipDirectory(string folderToZip, ZipOutputStream zipStream, string parentFolderName)
    {
        SetCode();

        bool result = true;
        string[] folders, files;
        ZipEntry ent = null;
        FileStream fs = null;
        FileInfo fileInfo = null;
        Crc32 crc = new Crc32();

        try
        {
            folders = Directory.GetDirectories(folderToZip, &quot;*&quot;, SearchOption.AllDirectories);
            files = Directory.GetFiles(folderToZip, &quot;*.*&quot;, SearchOption.AllDirectories)
                .Where(s =&gt; !ignoreExts.Contains(Path.GetExtension(s).ToLower()) &amp;&amp; !ignoreFiles.Contains(Path.GetFileName(s).ToLower()) ).ToArray();


            parentFolderName = folderToZip;
            if (!parentFolderName.EndsWith(&quot;/&quot;))
                parentFolderName += &quot;/&quot;;

            // 可以不需要压入文件夹。压人后在Mac下用默认的zip工具解压不了
//                foreach(string folder in folders)
//                {
//                    ent = new ZipEntry(folder.Replace(parentFolderName, &quot;&quot;) + &quot;/&quot;);
//                    zipStream.PutNextEntry(ent);
//                    zipStream.Flush();
//                }

            foreach(string file in files)
            {
                fileInfo = new FileInfo(file);
                fs = File.OpenRead(file);

                byte[] buffer = new byte[fs.Length];
                fs.Read(buffer, 0, buffer.Length);
                ent = new ZipEntry(file.Replace(parentFolderName, &quot;&quot;));
                ent.DateTime = fileInfo.LastWriteTime;
                ent.Size = fs.Length;

                fs.Close();
                
                crc.Reset();
                crc.Update(buffer);

                ent.Crc = crc.Value;
                zipStream.PutNextEntry(ent);
                zipStream.Write(buffer, 0, buffer.Length);
            }
            
             
        }
        catch
        {
            result = false;
        }
        finally
        {
            if (fs != null)
            {
                fs.Close();
                fs.Dispose();
            }
            if (ent != null)
            {
                ent = null;
            }
            GC.Collect();
            GC.Collect(1);
        }
        return result;
    }

    /// &lt;summary&gt; 
    /// 压缩文件夹  
    /// &lt;/summary&gt; 
    /// &lt;param name=&quot;folderToZip&quot;&gt;要压缩的文件夹路径&lt;/param&gt; 
    /// &lt;param name=&quot;zipedFile&quot;&gt;压缩文件完整路径&lt;/param&gt; 
    /// &lt;param name=&quot;password&quot;&gt;密码&lt;/param&gt; 
    /// &lt;returns&gt;是否压缩成功&lt;/returns&gt; 
    public static bool ZipDirectory(string folderToZip, string zipedFile, string password)
    {
        bool result = false;
        if (!Directory.Exists(folderToZip))
            return result;

        ZipOutputStream zipStream = new ZipOutputStream(File.Create(zipedFile));
        zipStream.SetLevel(9);
        if (!string.IsNullOrEmpty(password)) zipStream.Password = password;


        string fullPath = Path.GetFullPath(folderToZip);
        string parentPath = Path.GetFullPath(fullPath + &quot;/../&quot;);

        result = ZipDirectory(fullPath, zipStream, parentPath);

        zipStream.Finish();
        zipStream.Close();

        return result;
    }

    /// &lt;summary&gt; 
    /// 压缩文件夹 
    /// &lt;/summary&gt; 
    /// &lt;param name=&quot;folderToZip&quot;&gt;要压缩的文件夹路径&lt;/param&gt; 
    /// &lt;param name=&quot;zipedFile&quot;&gt;压缩文件完整路径&lt;/param&gt; 
    /// &lt;returns&gt;是否压缩成功&lt;/returns&gt; 
    public static bool ZipDirectory(string folderToZip, string zipedFile)
    {
        bool result = ZipDirectory(folderToZip, zipedFile, null);
        return result;
    }

    /// &lt;summary&gt; 
    /// 压缩文件 
    /// &lt;/summary&gt; 
    /// &lt;param name=&quot;fileToZip&quot;&gt;要压缩的文件全名&lt;/param&gt; 
    /// &lt;param name=&quot;zipedFile&quot;&gt;压缩后的文件名&lt;/param&gt; 
    /// &lt;param name=&quot;password&quot;&gt;密码&lt;/param&gt; 
    /// &lt;returns&gt;压缩结果&lt;/returns&gt; 
    public static bool ZipFile(string fileToZip, string zipedFile, string password)
    {
        SetCode();

        bool result = true;
        ZipOutputStream zipStream = null;
        FileStream fs = null;
        ZipEntry ent = null;

        if (!File.Exists(fileToZip))
            return false;

        try
        {
            fs = File.OpenRead(fileToZip);
            byte[] buffer = new byte[fs.Length];
            fs.Read(buffer, 0, buffer.Length);
            fs.Close();

            fs = File.Create(zipedFile);
            zipStream = new ZipOutputStream(fs);
            if (!string.IsNullOrEmpty(password)) zipStream.Password = password;
            ent = new ZipEntry(Path.GetFileName(fileToZip));
            zipStream.PutNextEntry(ent);
            zipStream.SetLevel(6);

            zipStream.Write(buffer, 0, buffer.Length);

        }
        catch
        {
            result = false;
        }
        finally
        {
            if (zipStream != null)
            {
                zipStream.Finish();
                zipStream.Close();
            }
            if (ent != null)
            {
                ent = null;
            }
            if (fs != null)
            {
                fs.Close();
                fs.Dispose();
            }
        }
        GC.Collect();
        GC.Collect(1);

        return result;
    }

    /// &lt;summary&gt; 
    /// 压缩文件 
    /// &lt;/summary&gt; 
    /// &lt;param name=&quot;fileToZip&quot;&gt;要压缩的文件全名&lt;/param&gt; 
    /// &lt;param name=&quot;zipedFile&quot;&gt;压缩后的文件名&lt;/param&gt; 
    /// &lt;returns&gt;压缩结果&lt;/returns&gt; 
    public static bool ZipFile(string fileToZip, string zipedFile)
    {
        bool result = ZipFile(fileToZip, zipedFile, null);
        return result;
    }

    /// &lt;summary&gt; 
    /// 压缩文件或文件夹 
    /// &lt;/summary&gt; 
    /// &lt;param name=&quot;fileToZip&quot;&gt;要压缩的路径&lt;/param&gt; 
    /// &lt;param name=&quot;zipedFile&quot;&gt;压缩后的文件名&lt;/param&gt; 
    /// &lt;param name=&quot;password&quot;&gt;密码&lt;/param&gt; 
    /// &lt;returns&gt;压缩结果&lt;/returns&gt; 
    public static bool Zip(string fileToZip, string zipedFile, string password)
    {
        bool result = false;
        if (Directory.Exists(fileToZip))
            result = ZipDirectory(fileToZip, zipedFile, password);
        else if (File.Exists(fileToZip))
            result = ZipFile(fileToZip, zipedFile, password);

        return result;
    }

    /// &lt;summary&gt; 
    /// 压缩文件或文件夹 
    /// &lt;/summary&gt; 
    /// &lt;param name=&quot;fileToZip&quot;&gt;要压缩的路径&lt;/param&gt; 
    /// &lt;param name=&quot;zipedFile&quot;&gt;压缩后的文件名&lt;/param&gt; 
    /// &lt;returns&gt;压缩结果&lt;/returns&gt; 
    public static bool Zip(string fileToZip, string zipedFile)
    {
        bool result = Zip(fileToZip, zipedFile, null);
        return result;

    }

    #endregion

    #region 解压

    /// &lt;summary&gt; 
    /// 解压功能(解压压缩文件到指定目录) 
    /// &lt;/summary&gt; 
    /// &lt;param name=&quot;fileToUnZip&quot;&gt;待解压的文件&lt;/param&gt; 
    /// &lt;param name=&quot;zipedFolder&quot;&gt;指定解压目标目录&lt;/param&gt; 
    /// &lt;param name=&quot;password&quot;&gt;密码&lt;/param&gt; 
    /// &lt;returns&gt;解压结果&lt;/returns&gt; 
    public static bool UnZip(string zipFilePath, string unZipDir, string password)
    {

        try
        {
            SetCode();

            if (zipFilePath == string.Empty)
            {
                throw new Exception(&quot;压缩文件不能为空！&quot;);
            }
            if (!File.Exists(zipFilePath))
            {
                throw new FileNotFoundException(&quot;压缩文件不存在！&quot;);
            }
            //解压文件夹为空时默认与压缩文件同一级目录下，跟压缩文件同名的文件夹  
            if (unZipDir == string.Empty)
                unZipDir = zipFilePath.Replace(Path.GetFileName(zipFilePath), Path.GetFileNameWithoutExtension(zipFilePath));
            
            if (!unZipDir.EndsWith(&quot;/&quot;))
                unZipDir += &quot;/&quot;;

            UnZip(File.OpenRead(zipFilePath), unZipDir, password);
        }
        catch(Exception e)
        {
            UnityEngine.Debug.LogError(e);
            return false;
        }

        return true;
    }

    public static bool UnZip(Stream baseInputStream, string unZipDir, string password)
    {
        try
        {
            SetCode();

            if (!unZipDir.EndsWith(&quot;/&quot;))
                unZipDir += &quot;/&quot;;

            if (!Directory.Exists(unZipDir))
                Directory.CreateDirectory(unZipDir);

            using (var s = new ZipInputStream(baseInputStream))
            {
                if(!string.IsNullOrEmpty(password)) s.Password = password;

                ZipEntry theEntry;
                while ((theEntry = s.GetNextEntry()) != null)
                {
                    string directoryName = Path.GetDirectoryName(theEntry.Name);
                    string fileName = Path.GetFileName(theEntry.Name);

                    if (!string.IsNullOrEmpty(directoryName))
                    {
                        Directory.CreateDirectory(unZipDir + directoryName);
                    }
                    if (directoryName != null &amp;&amp; !directoryName.EndsWith(&quot;/&quot;))
                    {
                    }
                    if (fileName != String.Empty)
                    {
                        using (FileStream streamWriter = File.Create(unZipDir + theEntry.Name))
                        {

                            int size;
                            byte[] data = new byte[2048];
                            while (true)
                            {
                                size = s.Read(data, 0, data.Length);
                                if (size &gt; 0)
                                {
                                    streamWriter.Write(data, 0, size);
                                }
                                else
                                {
                                    break;
                                }
                            }
                        }
                    }
                }
            }
        }
        catch(Exception e)
        {
            UnityEngine.Debug.LogError(e);
            return false;
        }

        return true;
    }

    /// &lt;summary&gt; 
    /// 解压功能(解压压缩文件到指定目录) 
    /// &lt;/summary&gt; 
    /// &lt;param name=&quot;fileToUnZip&quot;&gt;待解压的文件&lt;/param&gt; 
    /// &lt;param name=&quot;zipedFolder&quot;&gt;指定解压目标目录&lt;/param&gt; 
    /// &lt;returns&gt;解压结果&lt;/returns&gt; 
    public static bool UnZip(string fileToUnZip, string zipedFolder)
    {
        bool result = UnZip(fileToUnZip, zipedFolder, null);
        return result;
    }


    public static bool UnZip(Stream baseInputStream, string unZipDir)
    {
        return UnZip(baseInputStream, unZipDir, null);
    }


    public static bool UnZip(byte[] data, string unZipDir)
    {
        MemoryStream stream = new MemoryStream(data);
        stream.Position = 0;
        bool result =  UnZip(stream, unZipDir, null);
        stream.Dispose();
        stream.Close();
        return result;
    }
    #endregion
}
</pre>

<p><br />
<br /></p>
<h2 class="nav2">测试</h2>
<pre class="brush: csharp; ">
using UnityEngine;
using System.Collections;
using System.IO;

public class TestZip : MonoBehaviour {

    

    [ContextMenu("ZipDir")]
    public void ZipDir()
    {
        string dir = "dir";
        string zipFile = "blog.zip";
        ZipHelper.ZipDirectory(dir, zipFile);
    }

    [ContextMenu("UnZip")]
    public void UnZip()
    {

        string zipFile = "blog.zip";
        string outDir = "zipout";
        ZipHelper.UnZip(zipFile, outDir);
    }


    [ContextMenu("UnZip2")]
    public void UnZip2()
    {
        StartCoroutine(LoadZip());
    }

    IEnumerator LoadZip()
    {
        string zipFile = "blog.zip";
        string outDir = "zipout";
        WWW www = new WWW("file:///" + Application.dataPath + "/../" + zipFile);
        yield return www;


        ZipHelper.UnZip(www.bytes, outDir);
    }
}


</pre>
<p><br />
<br /></p>


</section>
<section class="page">

	 
  <span><a href="/csharp-proto-aes/#content" class="pageNav"  >上一篇: C# Java AES 协议加密</a></span>
  <br/>
  

  
	<span><a href="/csharp-Thread/#content" class="pageNav"  >下一篇: c#使用多线程的几种方式示例详解</a></span>
   

</section>


<div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
<script>
  var cloudTieConfig = {
    url: document.location.href, 
    sourceId: "20170104205100",
    productKey: "97dc4b8e4aeb41ca8606d2c6efa6eae3",
    target: "cloud-tie-wrapper"
  };
</script>
<script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>


      </article>


      <footer class="site-footer">

          <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?aa2fdee733dec8a2399b5bc0efbfd843";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

        <span class="site-footer-credits"><a href="http://www.ihaiu.com">爱海游</a></span> |
        <span class="site-footer-credits"><a href="http://blog.ihaiu.com">博客</a></span> |

        <script src="http://s4.cnzz.com/z_stat.php?id=1260003113&web_id=1260003113" language="JavaScript"></script>

        <p align="center">版权所有：©2021 ihaiu.com 版权所有ICP证： <a href="https://beian.miit.gov.cn/" target="_blank">沪ICP备2021002336号</a></p>
      </footer>

    </section>


  
  </body>
</html>


