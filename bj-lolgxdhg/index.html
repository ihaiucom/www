<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <meta name="author" content="ihaiu" />
    <title>【笔记】LOL图形管线之旅读后感</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/github-light.css" media="screen">
    <link type="text/css" rel="stylesheet" href="/stylesheets/offlintab-439.css">
    <link type="stylesheet" rel="stylesheet" href="/stylesheets/font-awesome.min.css">
    <!-- <link type="stylesheet" rel="stylesheet" href="/stylesheets/about-grid.css"> -->


    <!-- <link href="/feed/" rel="alternate" title="ihaiu" type="application/atom+xml" /> -->

    <link rel="shortcut icon" href="/assets/icon/favicon.ico" />

    <link href="/assets/icon/favicon.ico" type="image/x-icon" rel="shortcut icon bookmark" />
    <link rel="apple-touch-icon-precomposed" href="assets/icon/icon32.png">
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/icon/icon76.png">
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/icon/icon120.png">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/icon/icon152.png">

  <!-- 
  <script src="http://www.it165.net/statics/js//it165_pro.js" type="text/javascript"></script>
  <script type="text/javascript">SyntaxHighlighter.all();</script>
  -->


           
    <script type="text/javascript" src="/media/syntaxhighlighter_2.0.278/scripts/shCore.js"></script>
    <link type="text/css" rel="stylesheet" href="/media/syntaxhighlighter_2.0.278/styles/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="/media/syntaxhighlighter_2.0.278/styles/shThemeDefault.css"/>


      

      

      

      

      
      <script type="text/javascript" src="/media/syntaxhighlighter_2.0.278/scripts/shBrushCpp.js"></script>
      

      
      <script type="text/javascript" src="/media/syntaxhighlighter_2.0.278/scripts/shBrushCSharp.js"></script>
      

      

      

      

      

      

      


      

      
      

      

      

      

      

      

      

      

      

      

      

      



    <script type="text/javascript">SyntaxHighlighter.all();</script>


   

  </head>

  <body>
    <section class="page-header">
      <a href="http://www.ihaiu.com" class="iconbtn"><h1 style="background-image: url('/assets/icon/icon76_white.png'); background-position: center center; background-repeat:no-repeat; height:76px; margin:0px;"></h1></a>
      <a href="http://www.ihaiu.com" class="iconbtn"><h1 class="project-name" >爱海游</h1></a>
      <h2 class="project-tagline">ihaiu.com</h2>
      <a href="/#content" class="btn">目录</a>
      <a href="/categories/#content" class="btn">分类</a>
     <!--  <a href="/guestbook/#content" class="btn">留言</a> -->
     <!--  <a href="/about/#content" class="btn">关于</a> -->
      <a href="/opensource/#content" class="btn">开源分享</a>
      <a href="/share/#content" class="btn">分享</a>
     <!--  <a href="/share/gameart#content" class="btn">游戏美术</a> -->
      <a href="/friendlylink/#content" class="btn">友情链接</a>
    </section>





    <section class="main-content" id="content">

      <h1>【笔记】LOL图形管线之旅读后感</h1>
      <article class="content">
        <section class="meta">
<span class="time">
  <time datetime="2020-12-15">2020-12-15</time>
</span>

 | 
<span class="categories">
  发布
  <a href="tencent://message/?uin=593705098" title="发布:大海明月 QQ:593705098" rel="author">大海明月</a>&nbsp;
  
  <a href="mailto:zengfeng75@qq.com" title="发布:大海明月 Email:zengfeng75@qq.com" rel="author">zengfeng75@qq.com</a>&nbsp;
  
</span>



 | 
<span class="categories">
  分类
  
  <a href="/categories/#游戏技术" title="游戏技术">游戏技术</a>&nbsp;
  
</span>


 | 
<span class="tags">
  标签
  
  <a href="/tags/#游戏技术" title="游戏技术">游戏技术</a>&nbsp;
  
</span>

</section>
<section class="post">
<h1 id="阴影">阴影</h1>

<ol>
  <li>
    <p>通过灯光角度去渲染，每个像素存储rgb(灯光到阴影的投射距离)、a（阴影区域）</p>
  </li>
  <li>
    <p>对阴影进行模糊处理，使表现有柔和的边缘</p>
  </li>
  <li>
    <p>猜测1：渲染地图表面时，通过灯光视角生成屏幕UV，采用这张渲染好的贴图控制在阴影区域的地图颜色为黑色。</p>
  </li>
  <li>
    <p>猜测2：有一个屏幕这么大的平面mesh贴在地图表面之上，用把这张贴图给到这个平面</p>

    <p><img src="https://blog.ihaiu.com/assets/docpic/2020-12-15-笔记-LOL图形管线之旅读后感/rendering_shadows_only_2.jpg" alt="img" /></p>

    <p><img src="https://blog.ihaiu.com/assets/docpic/2020-12-15-笔记-LOL图形管线之旅读后感/rendering_shadows_only_1.jpg" alt="img" /></p>
  </li>
</ol>

<p><img src="https://blog.ihaiu.com/assets/docpic/2020-12-15-笔记-LOL图形管线之旅读后感/rendering_static_geo.jpg" alt="img" /></p>

<p><img src="https://blog.ihaiu.com/assets/docpic/https://technology.riotgames.com/sites/default/files/rendering_full_scene_animated.gif" alt="img" /></p>

<h1 id="轮廓">轮廓</h1>

<p>通过获取上一阶段的缩放深度并使用<a href="https://en.wikipedia.org/wiki/Sobel_operator">Sobel滤镜对其</a>进行处理以提取边缘，然后在蒙皮网格上渲染回来，从而生成轮廓。</p>

<p><strong>猜测:</strong></p>

<ol>
  <li>先用摄像机角度渲染一张小的屏幕缓冲，只渲染单位类型的模型</li>
  <li>将这张贴图放大</li>
  <li>对这张图进行边缘检测，提取边缘</li>
  <li>可以将处理好的用于屏幕后期处理，叠加以显示描边轮廓</li>
</ol>

<h1 id="后期处理效果抗锯齿">后期处理效果–抗锯齿</h1>

<p><strong>FXAA(Fast Approximate Anti-Aliasing):</strong></p>

<ol>
  <li>找出图像中的所有边缘</li>
  <li>平滑边缘</li>
</ol>

<p><strong>SSAA（Super Sampling AA）：</strong></p>

<p>拿4xSSAA举例子</p>

<ol>
  <li>假设最终屏幕输出的分辨率是800x600</li>
  <li>4xSSAA就会先渲染到一个分辨率1600x1200的buffer上</li>
  <li>然后再直接把这个放大4倍的buffer下采样致800x600</li>
</ol>

<p>这种做法在数学上是最完美的抗锯齿。但是劣势也很明显，光栅化和着色的计算负荷都比原来多了4倍，render target的大小也涨了4倍。</p>

<p><strong>MSAA（Multi-Sampling AA）：</strong></p>

<p>只是在光栅化阶段，判断一个三角形是否被像素覆盖的时候会计算多个覆盖样本（Coverage sample），但是在pixel shader着色阶段计算像素颜色的时候每个像素还是只计算一次。</p>

<p>例如下图是4xMSAA，三角形只覆盖了4个coverage sample中的2个。所以这个三角形需要生成一个fragment在pixel shader里着色，只不过生成的fragment还是在像素中央（位置，法线等信息插值到像素中央）然后只运行一次pixel shader，最后得到的结果在resolve阶段会乘以0.5，因为这个三角形只cover了一半的sample。现代所有GPU都在硬件上实现了这个算法，而且在shading的运算量远大于光栅化的今天，这个方法远比SSAA快很多。顺便提一下之前NV的CSAA，它就是更进一步的把coverage sample和depth，stencil test分开了。</p>

<ol>
  <li>只是在光栅化阶段</li>
  <li>判断一个三角形是否被像素覆盖的时候会计算多个覆盖样本（Coverage sample</li>
  <li>pixel shader着色阶段计算像素颜色的时候每个像素还是只计算一次</li>
</ol>

<p><img src="https://blog.ihaiu.com/assets/docpic/2020-12-15-笔记-LOL图形管线之旅读后感/e4b5148a3cf4e38e2183069f9848ec84_720w.jpg" alt="img" /></p>

<h1 id="hud-三角形数量">HUD 三角形数量</h1>

<table>
  <thead>
    <tr>
      <th>名称</th>
      <th>三角形数量</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>HUD总的</td>
      <td>1000</td>
    </tr>
    <tr>
      <td>小地图</td>
      <td>300</td>
    </tr>
    <tr>
      <td>其余</td>
      <td>700</td>
    </tr>
  </tbody>
</table>

<h1 id="所有-三角形数量">所有 三角形数量</h1>

<table>
  <thead>
    <tr>
      <th>名称</th>
      <th>三角形数量</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>整个场景</td>
      <td>20万</td>
    </tr>
    <tr>
      <td>粒子</td>
      <td>9万</td>
    </tr>
    <tr>
      <td>绘图调用可渲染2800万像素</td>
      <td>695</td>
    </tr>
  </tbody>
</table>

<h1 id="相关文档">相关文档</h1>

<p><a href="https://technology.riotgames.com/news/story-fog-and-war">《英雄联盟》战争迷雾 https://technology.riotgames.com/news/story-fog-and-war</a></p>

<p><a href="https://en.wikipedia.org/wiki/Sobel_operator">索贝尔算子 Sobel， 边缘检测技术</a></p>

<p><a href="https://zh.wikipedia.org/wiki/%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8B">边缘检测</a></p>

<p><a href="https://zh.wikipedia.org/wiki/%E5%BF%AB%E9%80%9F%E8%BF%91%E4%BC%BC%E6%8A%97%E9%8B%B8%E9%BD%92">快速近似抗锯齿 FXAA</a></p>

<p><a href="https://blog.codinghorror.com/fast-approximate-anti-aliasing-fxaa/">快速近似抗锯齿 （FXAA）</a></p>

<p><a href="https://developer.download.nvidia.cn/assets/gamedev/files/sdk/11/FXAA_WhitePaper.pdf">快速近似抗锯齿 FXAA 白皮书</a></p>

<p><a href="https://www.zhihu.com/question/20236638">请问FXAA、FSAA与MSAA有什么区别？效果和性能上哪个好？</a></p>


</section>
<section class="page">

	 
  <span><a href="/bj-zhanzhenmiwu/#content" class="pageNav"  >上一篇: 【笔记】《英雄联盟》战争迷雾</a></span>
  <br/>
  

   

</section>


<div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
<script>
  var cloudTieConfig = {
    url: document.location.href, 
    sourceId: "20201215205400",
    productKey: "97dc4b8e4aeb41ca8606d2c6efa6eae3",
    target: "cloud-tie-wrapper"
  };
</script>
<script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>


      </article>


      <footer class="site-footer">

          <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?aa2fdee733dec8a2399b5bc0efbfd843";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

        <span class="site-footer-credits"><a href="http://www.ihaiu.com">爱海游</a></span> |
        <span class="site-footer-credits"><a href="http://blog.ihaiu.com">博客</a></span> |

        <script src="http://s4.cnzz.com/z_stat.php?id=1260003113&web_id=1260003113" language="JavaScript"></script>

        <p align="center">版权所有：©2021 ihaiu.com 版权所有ICP证： <a href="https://beian.miit.gov.cn/" target="_blank">沪ICP备2021002336号</a></p>
      </footer>

    </section>


  
  </body>
</html>


